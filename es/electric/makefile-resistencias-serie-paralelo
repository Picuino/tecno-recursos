# HELP
#   object: dependencies
#   $@ object
#   $^ dependencies
#   $< first element of dependencies list

IMGDIR=_images
SOURCES=_sources

LIBS=$(wildcard _symbol_lib/*) $(wildcard Licen*)

JOINPDF=gswin32.exe -dBATCH -dNOPAUSE -q -sDEVICE=pdfwrite
PDFTOPNG=pdftopng -gray -r 600 -aa yes -aaVector yes -freetype yes
OPTIPNG=optipng -quiet -o 5
CONVERT=convert
CONVERT_OPT=-transparent White
MOGRIFY=mogrify
ZIP=7z a
PYTHON=python


# --------------------------------------------------------------------
# electric-resistencias-serie-paralelo
#

$(IMGDIR)/electric-resistencias-serie-paralelo-p1.png \
$(IMGDIR)/electric-resistencias-serie-paralelo-p2.png: electric-resistencias-serie-paralelo.pdf
	$(PDFTOPNG) $< $(basename $<)
	mv $(basename $<)-000001.png  $(IMGDIR)/$(basename $<)-p1.png
	mv $(basename $<)-000002.png  $(IMGDIR)/$(basename $<)-p2.png
	$(MOGRIFY) -posterize 16 $(IMGDIR)/$(basename $<)-p1.png
	$(MOGRIFY) -posterize 16 $(IMGDIR)/$(basename $<)-p2.png
	$(OPTIPNG) $(IMGDIR)/$(basename $<)-p1.png
	$(OPTIPNG) $(IMGDIR)/$(basename $<)-p2.png


electric-resistencias-serie-paralelo.zip: $(LIBS) $(wildcard resistencias-serie-paralelo/*)
	rm -f $@  resistencias-serie-paralelo/*.*bak
	$(ZIP) $@ $^


# --------------------------------------------------------------------
# electric-resistencias-serie-paralelo-images
#
define crop_image
	$(eval geometry = $(shell python -c "import sys; (x1, y1, x2, y2)=eval(sys.argv[1]); \
	print('%dx%d+%d+%d'%(x2-x1, y2-y1, x1, y1))" $(1)))
	$(CONVERT) $(2) -crop $(geometry) +repage $(CONVERT_OPT) $(3)
	$(OPTIPNG) $(3)
endef


$(IMGDIR)/electric-resistencias-serie-paralelo-3.png: electric-resistencias-serie-paralelo-3.pdf
	$(PDFTOPNG) $< $(basename $<)
	mv $(basename $<)-000001.png  $(IMGDIR)/$(basename $<).png
	$(MOGRIFY) -posterize 16 $(IMGDIR)/$(basename $<).png
	$(OPTIPNG) $(IMGDIR)/$(basename $<).png


$(IMGDIR)/electric-resistencias-serie-paralelo-01.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(130, 772, 2420, 1580)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-02.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(130, 1920, 2420, 2960)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-03.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(3290, 620, 4824, 1632)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-04.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(3290, 1880, 4824, 2954)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-05.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(130, 3144, 1675, 4236 )", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-06.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(130, 4400, 1675, 5490)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-07.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(300, 5780, 1436, 6782)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-08.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(1716, 4400, 3250, 5452)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-09.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(3470, 4654, 4588, 5478)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-10.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(1716, 5662, 3250, 6794)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-11.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(3480, 5764, 4596, 6796)", $^, $@)

$(IMGDIR)/electric-resistencias-serie-paralelo-12.png: $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	$(call crop_image, "(1845, 3432, 3020, 4275)", $^, $@)



.PHONY: all clean
all: \
	electric-resistencias-serie-paralelo.zip \
	$(IMGDIR)/electric-resistencias-serie-paralelo-p1.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-p2.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-3.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-01.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-02.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-03.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-04.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-05.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-06.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-07.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-08.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-09.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-10.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-11.png \
	$(IMGDIR)/electric-resistencias-serie-paralelo-12.png \


clean:
	rm -f electric-resistencias-serie-paralelo.zip
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-p1.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-p2.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-3.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-01.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-02.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-03.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-04.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-05.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-06.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-07.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-08.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-09.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-10.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-11.png
	rm -f $(IMGDIR)/electric-resistencias-serie-paralelo-12.png
